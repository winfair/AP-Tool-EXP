<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no"/>
<title>Map App ‚Äî Lean+Guide (Hi-Res Heading + Better Info Bar)</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>
<style>
:root{--bg:#0b0f10;--panel:#12181a;--text:#e7f6ef;--accent:#29a36a;--dim:#91c7ae;--danger:#ff6b6b}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);-webkit-tap-highlight-color:transparent}
#map{position:fixed;inset:0;height:100svh;width:100vw}
.controls{position:fixed;top:env(safe-area-inset-top,12px);left:50%;transform:translateX(-50%);display:flex;gap:8px;background:rgba(18,24,26,.85);padding:8px 10px;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.35);z-index:1000;backdrop-filter:blur(6px)}
.btn{appearance:none;border:1px solid rgba(255,255,255,.12);background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));color:var(--text);padding:8px 10px;border-radius:10px;font:600 14px/1 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;cursor:pointer}
.btn.primary{border-color:var(--accent)}.btn.toggled{outline:2px solid var(--accent)}
.badge{padding:0 8px;border-radius:999px;background:rgba(255,255,255,.1);font-size:12px;margin-left:6px}
.fab{position:fixed;right:14px;bottom:calc(env(safe-area-inset-bottom,14px) + 56px);z-index:1000;width:48px;height:48px;border-radius:50%;display:grid;place-items:center;background:rgba(18,24,26,.9);border:1px solid rgba(255,255,255,.12)}
.panel{position:fixed;right:12px;bottom:calc(env(safe-area-inset-bottom,12px) + 120px);width:min(92vw,360px);max-height:60vh;overflow:auto;background:rgba(18,24,26,.95);border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:12px;z-index:1000;box-shadow:0 12px 32px rgba(0,0,0,.45);display:none}
.panel.open{display:block}
.row{display:grid;gap:8px;margin:10px 0}
.row input,.row button{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);color:var(--text);font:500 14px/1.2 system-ui,sans-serif}
.list{display:grid;gap:8px}
.item{display:grid;grid-template-columns:1fr auto auto;gap:6px;align-items:center;padding:8px;border:1px solid rgba(255,255,255,.08);border-radius:10px}
.item small{color:var(--dim);display:block}.item button{padding:6px 10px}
.danger{border-color:var(--danger);color:var(--danger)}
.leaflet-control-attribution,.leaflet-control-zoom{filter:drop-shadow(0 6px 12px rgba(0,0,0,.35))}
.leaflet-container a{color:var(--dim)}.leaflet-map-pane{will-change:transform}
.leaflet-popup-content{font:500 13px/1.3 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:var(--text)}
/* compact glass popup + tiny label */
.floating-popup .leaflet-popup-content-wrapper{background:rgba(18,24,26,.92);border:1px solid rgba(255,255,255,.12);backdrop-filter:blur(8px);border-radius:12px;box-shadow:0 10px 24px rgba(0,0,0,.45)}
.floating-popup .leaflet-popup-tip{background:rgba(18,24,26,.92);border:1px solid rgba(255,255,255,.12)}
.floating-popup .leaflet-popup-content{margin:10px 12px}
.popup-grid{display:grid;gap:8px}
.popup-actions{display:flex;gap:8px;justify-content:flex-end}
.popup-actions .btn{padding:6px 10px;font-size:13px}
.popup-input{width:100%;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06);color:var(--text);font:500 13px/1}
.mini-label{background:rgba(18,24,26,.85);color:var(--text);padding:2px 6px;border:1px solid rgba(255,255,255,.12);border-radius:8px;font:600 12px/1 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;backdrop-filter:blur(4px);pointer-events:none}

/* UPDATED bottom info bar ‚Äî mobile friendly, full width */
.info{
  position:fixed;left:12px;right:12px;
  bottom:env(safe-area-inset-bottom,12px);
  background:rgba(18,24,26,.9);
  padding:10px 12px;border-radius:14px;
  font:500 13px/1.25 ui-monospace,SFMono-Regular,Menlo,monospace;
  color:var(--dim);z-index:1000;
  box-shadow:0 6px 18px rgba(0,0,0,.35);
  backdrop-filter:blur(6px)
}
.info .metrics{display:flex;flex-wrap:wrap;gap:10px 14px;align-items:baseline}
.info .metric{display:flex;gap:6px;align-items:baseline}
.info .metric span{color:var(--dim);font:600 12px/1 system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
.info .metric .value{color:var(--text);font:700 15px/1 ui-monospace;letter-spacing:.2px}
</style>
</head><body>
<div id="map"></div>

<div class="controls">
  <button id="btnLocate" class="btn primary">Enable GPS</button>
  <button id="btnFollow" class="btn toggled">Follow: <span id="followState" class="badge">on</span></button>
  <button id="btnCompass" class="btn">Compass <span id="compassState" class="badge">off</span></button>
  <button id="btnReset" class="btn">Reset</button>
</div>

<button id="btnWaypoints" class="btn fab" title="Waypoints">üìç</button>
<div id="wpPanel" class="panel" aria-hidden="true">
  <div class="row">
    <input id="wpName" placeholder="Name (e.g., Tower SE)"/>
    <input id="wpCoords" placeholder='Coords (e.g., 34.851939 N, -119.168399 W or 34.851939,-119.168399)'/>
    <button id="wpAdd" class="btn primary">Add / Update</button>
  </div>
  <div class="list" id="wpList"></div>
</div>

<div class="info" id="readout">
  <div class="metrics"></div>
</div>

<script>
(()=>{const $=i=>document.getElementById(i),
N=d=>(d%360+360)%360,D=(a,b)=>{let d=N(b)-N(a);return d>180?d-360:d<-180?d+360:d},
E=(p,n,a)=>p==null?n:N(p+a*D(p,n)),R=d=>d*Math.PI/180,Deg=r=>r*180/Math.PI,F=v=>Number(v).toFixed(6),
S={follow:true,heading:null,bearing:0,compass:false,press:false,fAngle:null,fPivot:null,dest:null},
DEF={lat:34.9,lng:-119.17,z:16},
map=L.map('map',{zoomControl:true,attributionControl:true});
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:20,minZoom:2,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(map);
map.setView([DEF.lat,DEF.lng],DEF.z);
let lastPos=null,ray=null,originDot=null,navLine=null;
const readout=$('readout'),followBadge=$('followState'),btnFollow=$('btnFollow'),compassBadge=$('compassState'),btnReset=$('btnReset');
const accuracy=L.circle([DEF.lat,DEF.lng],{radius:0,color:'#4db6ff',weight:1,opacity:.6,fillOpacity:.08}).addTo(map);

/* geo helpers */
const mpp=()=>{const s=map.getSize(),a=map.containerPointToLatLng(L.point(s.x/2,s.y/2)),b=map.containerPointToLatLng(L.point(s.x/2+1,s.y/2));return map.distance(a,b)||1},
rayLen=()=>{const s=map.getSize();return Math.max(Math.hypot(s.x,s.y)*mpp()*1.35+200,3000)},
dest=(ll,b,dm)=>{const br=R(b),dr=dm/6371000,lat1=R(ll.lat),lon1=R(ll.lng),lat2=Math.asin(Math.sin(lat1)*Math.cos(dr)+Math.cos(lat1)*Math.sin(dr)*Math.cos(br)),lon2=lon1+Math.atan2(Math.sin(br)*Math.sin(dr)*Math.cos(lat1),Math.cos(dr)-Math.sin(lat1)*Math.sin(lat2));return L.latLng(Deg(lat2),Deg(lon2))},
distM=(a,b)=>{const Rm=6371000,œÜ1=R(a.lat),œÜ2=R(b.lat),dœÜ=R(b.lat-a.lat),dŒª=R(b.lng-a.lng),s=Math.sin(dœÜ/2)**2+Math.cos(œÜ1)*Math.cos(œÜ2)*Math.sin(dŒª/2)**2;return 2*Rm*Math.asin(Math.min(1,Math.sqrt(s)))},
bear=(a,b)=>{const œÜ1=R(a.lat),œÜ2=R(b.lat),Œª1=R(a.lng),Œª2=R(b.lng),y=Math.sin(Œª2-Œª1)*Math.cos(œÜ2),x=Math.cos(œÜ1)*Math.sin(œÜ2)-Math.sin(œÜ1)*Math.cos(œÜ2)*Math.cos(Œª2-Œª1);return N(Deg(Math.atan2(y,x)))},
fmtDist=m=>m<1000?`${Math.round(m)} m`:`${(m/1000).toFixed(2)} km`;

/* rotation + visuals */
const applyBearing=d=>{const pane=map.getPane('mapPane');if(!pane)return;let o='50% 50%';if(lastPos){const p=map.latLngToContainerPoint([lastPos.coords.latitude,lastPos.coords.longitude]);o=`${p.x}px ${p.y}px`;}pane.style.transformOrigin=o;pane.style.transform=(pane.style.transform||'').replace(/rotate\([^)]*\)/g,'')+` rotate(${-d}deg)`;},

/* UPDATED: higher precision, mobile-friendly readout */
function updateReadout(){
  const lat = lastPos?.coords?.latitude?.toFixed(6) ?? '‚Äî';
  const lng = lastPos?.coords?.longitude?.toFixed(6) ?? '‚Äî';
  const acc = lastPos?.coords?.accuracy ? Math.round(lastPos.coords.accuracy) : '‚Äî';
  const hd  = S.heading != null ? (S.heading).toFixed(2) : '‚Äî';
  const mb  = (N(-S.bearing)).toFixed(2);

  let navHtml = '';
  if (S.dest && lastPos){
    const me = L.latLng(lastPos.coords.latitude, lastPos.coords.longitude);
    const to = L.latLng(S.dest.lat, S.dest.lng);
    const d  = distM(me, to);
    const b  = bear(me, to);            // numeric
    const bStr = b.toFixed(2);
    const steer = S.heading==null ? '‚Äî' : (D(S.heading, b)).toFixed(2);
    navHtml = `
      <div class="metric"><span>To</span><b class="value">${S.dest.name||'Dest'}</b></div>
      <div class="metric"><span>Dist</span><b class="value">${fmtDist(d)}</b></div>
      <div class="metric"><span>Brg</span><b class="value">${bStr}&deg;</b></div>
      <div class="metric"><span>Œî</span><b class="value">${steer}&deg;</b></div>
    `;
  }

  readout.innerHTML = `
    <div class="metrics">
      <div class="metric"><span>Lat</span><b class="value">${lat}</b></div>
      <div class="metric"><span>Lng</span><b class="value">${lng}</b></div>
      <div class="metric"><span>Acc</span><b class="value">${acc} m</b></div>
      <div class="metric"><span>Head</span><b class="value">${hd}&deg;</b></div>
      <div class="metric"><span>Map</span><b class="value">${mb}&deg;</b></div>
      ${navHtml}
    </div>`;
}

const refreshRay=()=>{if(!lastPos){if(ray)ray.setLatLngs([]);return}const o=L.latLng(lastPos.coords.latitude,lastPos.coords.longitude);if(!originDot){originDot=L.circleMarker(o,{radius:3,color:'#2aff2a',weight:2,fillColor:'#2aff2a',fillOpacity:1,interactive:false}).addTo(map)}else originDot.setLatLng(o).bringToFront();if(S.heading==null)return;if(!ray)ray=L.polyline([],{color:'#2aff2a',weight:3,opacity:1,interactive:false}).addTo(map);ray.setLatLngs([o,dest(o,S.heading,rayLen())]).bringToFront()},
refreshNav=()=>{if(!S.dest||!lastPos){if(navLine){navLine.setLatLngs([])}btnReset.textContent='Reset';return}
btnReset.textContent='Clear Nav';
if(!navLine)navLine=L.polyline([], {color:'#29a36a',weight:3,opacity:.9,interactive:false,dashArray:'6 6'}).addTo(map);
navLine.setLatLngs([ [lastPos.coords.latitude,lastPos.coords.longitude], [S.dest.lat,S.dest.lng] ]).bringToFront();},

pivotLL=()=>lastPos?L.latLng(lastPos.coords.latitude,lastPos.coords.longitude):map.getCenter(),
latLngFromPt=pt=>{const panePos=map._getMapPanePos(),layer=L.point(pt.x-panePos.x,pt.y-panePos.y),ang=(S.press&&S.fAngle!=null)?S.fAngle:S.bearing,pivot=(S.press&&S.fPivot)?S.fPivot:map.latLngToLayerPoint(pivotLL()),th=R(ang),c=Math.cos(th),s=Math.sin(th),dx=layer.x-pivot.x,dy=layer.y-pivot.y,un=L.point(pivot.x+dx*c+dy*s,pivot.y+(-dx*s)+dy*c);return map.layerPointToLatLng(un)};

/* RAF */
(function loop(){const target=(S.rotate??true)?(S.heading??0):0;S.bearing+=D(N(S.bearing),target);applyBearing(S.bearing);updateReadout();requestAnimationFrame(loop)})();
map.on('move moveend zoom zoomend zoomanim',()=>{applyBearing(S.bearing);refreshRay();refreshNav()});
addEventListener('resize',()=>{map.invalidateSize();applyBearing(S.bearing);refreshRay();refreshNav()},{passive:true});

/* sensors */
function onOrient(e){let h=typeof e.webkitCompassHeading==='number'?e.webkitCompassHeading:typeof e.alpha==='number'?e.alpha:null;if(h==null||isNaN(h))return;h=N(h);if(S.heading==null){S.heading=h;if(S.rotate)S.bearing=h}else{const a=Math.abs(D(S.heading,h))<12?0.12:0.3,n=E(S.heading,h,a);if(Math.abs(D(S.heading,n))>=1)S.heading=n}refreshRay();refreshNav()}
async function enableCompass(){if(S.compass)return true;try{if(typeof DeviceOrientationEvent!=='undefined'&&typeof DeviceOrientationEvent.requestPermission==='function'){if((await DeviceOrientationEvent.requestPermission())!=='granted'){alert('Compass permission denied.');return false}}addEventListener('deviceorientationabsolute',onOrient,true);addEventListener('deviceorientation',onOrient,true);S.compass=true;return true}catch{alert('Compass access failed.');return false}}

/* GPS */
function startGPS(){if(!('geolocation'in navigator))return alert('Geolocation not supported.');navigator.geolocation.watchPosition(p=>{lastPos=p;const{latitude,longitude,accuracy:acc,heading}=p.coords,ll=[latitude,longitude];accuracy.setLatLng(ll).setRadius(Math.max(acc||0,0));if(S.follow&&!S.press)map.setView(ll,Math.max(map.getZoom(),16),{animate:false});if(Number.isFinite(heading)){const h=N(heading);if(S.heading==null)S.heading=h;else{const a=Math.abs(D(S.heading,h))<12?0.12:0.3,n=E(S.heading,h,a);if(Math.abs(D(S.heading,n))>=1)S.heading=n}}applyBearing(S.bearing);refreshRay();refreshNav();updateReadout()},e=>alert('Unable to get location: '+e.message),{enableHighAccuracy:true,maximumAge:2000,timeout:15000})}

/* view/follow/reset */
function resetView(){ if(S.dest){ S.dest=null; refreshNav(); updateReadout(); return; }
if(lastPos){const{latitude,longitude}=lastPos.coords;map.setView([latitude,longitude],Math.max(map.getZoom(),16))}else map.setView([DEF.lat,DEF.lng],DEF.z);applyBearing(S.bearing)}
function setFollow(v){S.follow=!!v;followBadge.textContent=S.follow?'on':'off';btnFollow.classList.toggle('toggled',S.follow);if(S.follow&&lastPos){const{latitude,longitude}=lastPos.coords;map.setView([latitude,longitude],Math.max(map.getZoom(),16),{animate:false});applyBearing(S.bearing)}}

/* waypoints */
const key='mapapp.waypoints.v1',markers=new Map(),
loadW=()=>{try{return JSON.parse(localStorage.getItem(key)||'[]')}catch{return[]}},
saveW=a=>localStorage.setItem(key,JSON.stringify(a)),
renderW=()=>{const list=$('wpList');list.innerHTML='';loadW().forEach((w,i)=>{const d=document.createElement('div');d.className='item';d.innerHTML=`<div><strong>${w.name}</strong><small>${w.lat.toFixed(6)}, ${w.lng.toFixed(6)}</small></div><button class="btn" data-go="${i}">Go</button><button class="btn danger" data-del="${i}">Del</button>`;list.appendChild(d)})},
upsertW=(name,lat,lng)=>{const a=loadW(),nm=(name?.trim())||`WP ${Date.now().toString().slice(-5)}`,i=a.findIndex(w=>w.name.toLowerCase()===nm.toLowerCase()),e={name:nm,lat,lng};if(i>=0)a[i]=e;else a.push(e);saveW(a);renderW();syncM()},
delW=i=>{const a=loadW();const[rm]=a.splice(i,1);saveW(a);renderW();if(rm&&markers.has(rm.name)){map.removeLayer(markers.get(rm.name));markers.delete(rm.name)}},
syncM=()=>{const a=loadW();a.forEach(w=>{if(!markers.has(w.name)){const m=L.marker([w.lat,w.lng]).addTo(map);bindPopup(m,{name:w.name,lat:w.lat,lng:w.lng,wp:true});markers.set(w.name,m)}else{const m=markers.get(w.name);m.setLatLng([w.lat,w.lng]);bindPopup(m,{name:w.name,lat:w.lat,lng:w.lng,wp:true})}});[...markers.keys()].forEach(n=>{if(!a.some(w=>w.name===n)){map.removeLayer(markers.get(n));markers.delete(n)}})};

/* popup */
const popHTML=(nm,lat,lng)=>{const a=F(lat),b=F(lng);return `<div class="popup-grid"><input class="popup-input" type="text" placeholder="Name" value="${nm||`Pin ${a},${b}`}" data-name/><div style="color:var(--dim);font-size:12px">${a}, ${b}</div><div class="popup-actions"><button class="btn" data-copy>Copy</button><button class="btn" data-min>Minimize</button><button class="btn" data-guide>Guide</button><button class="btn primary" data-save>Save</button></div></div>`};
function bindPopup(m,o){const{name,lat,lng}=o;m.unbindPopup();m.bindPopup(popHTML(name,lat,lng),{className:'floating-popup',autoClose:true,closeButton:true,offset:[0,-10]}).off('popupopen').on('popupopen',()=>{const el=m.getPopup().getElement(),I=el.querySelector('[data-name]'),C=el.querySelector('[data-copy]'),SAV=el.querySelector('[data-save]'),MIN=el.querySelector('[data-min]'),G=el.querySelector('[data-guide]');
C?.addEventListener('click',async()=>{const txt=`${F(lat)}, ${F(lng)}`;try{await navigator.clipboard.writeText(txt);C.textContent='Copied';setTimeout(()=>C.textContent='Copy',1000)}catch{prompt('Copy to clipboard:',txt)}});
SAV?.addEventListener('click',()=>{const nm=(I?.value||'').trim()||`WP ${Date.now().toString().slice(-5)}`;upsertW(nm,lat,lng);m.closePopup();m._nm=nm});
MIN?.addEventListener('click',()=>{const nm=(I?.value||m._nm||'Pin')||'Pin';m.bindTooltip(nm,{permanent:true,direction:'right',offset:[8,0],className:'mini-label'}).openTooltip();m.closePopup();m._nm=nm});
G?.addEventListener('click',()=>{S.dest={lat,lng,name:(I?.value||m._nm||'Dest')};refreshNav();updateReadout();m.closePopup();});})}

/* precise long-press */
const container=map.getContainer();let t=null,start=null,last=null;const LONG=420,MOVE=6,
pt=e=>{const r=container.getBoundingClientRect();return L.point(e.clientX-r.left,e.clientY-r.top)},
freezeS=()=>{S.press=true;S.fAngle=S.bearing;S.fPivot=map.latLngToLayerPoint(pivotLL())},
freezeE=()=>{S.press=false;S.fAngle=null;S.fPivot=null},
dropAt=ll=>{if(window.__pin){map.removeLayer(window.__pin)}window.__pin=L.marker(ll).addTo(map);bindPopup(window.__pin,{name:`Pin ${F(ll.lat)},${F(ll.lng)}`,lat:ll.lat,lng:ll.lng,wp:false});window.__pin.openPopup()};

container.addEventListener('pointerdown',e=>{if(e.button!==0&&e.pointerType==='mouse')return;e.preventDefault();freezeS();start=last=pt(e);clearTimeout(t);t=setTimeout(()=>{t=null;dropAt(latLngFromPt(last));freezeE()},LONG)},{passive:false});
container.addEventListener('pointermove',e=>{if(!t)return;e.preventDefault();last=pt(e);if(Math.hypot(last.x-start.x,last.y-start.y)>MOVE){clearTimeout(t);freezeE()}},{passive:false});
['pointerup','pointercancel','pointerleave'].forEach(ev=>container.addEventListener(ev,()=>{clearTimeout(t);freezeE()},{passive:true}));
map.on('contextmenu',e=>{e.originalEvent?.preventDefault();freezeS();const p=e.containerPoint??pt(e.originalEvent);dropAt(latLngFromPt(p));freezeE()});

/* UI */
$('btnLocate').addEventListener('click',startGPS);
$('btnCompass').addEventListener('click',async()=>{if(!await enableCompass())return;S.rotate=!(S.rotate??true);compassBadge.textContent=S.rotate?'on':'off';$('btnCompass').classList.toggle('toggled',S.rotate);applyBearing(S.bearing);if(S.rotate)setFollow(true)});
btnReset.addEventListener('click',resetView);
btnFollow.addEventListener('click',()=>setFollow(!S.follow));

const btnWP=$('btnWaypoints'),wpPanel=$('wpPanel'),wpName=$('wpName'),wpCoords=$('wpCoords');
btnWP.addEventListener('click',()=>{wpPanel.classList.toggle('open');wpPanel.setAttribute('aria-hidden',wpPanel.classList.contains('open')?'false':'true')});
$('wpAdd').addEventListener('click',()=>{const t=wpCoords.value.trim().replace(/\s+/g,' ').replace(/[,;]+/g,','),m=t.match(/^\s*([+-]?\d+(\.\d+)?)\s*,\s*([+-]?\d+(\.\d+)?)\s*$/i);let p=null;if(m){const lat=parseFloat(m[1]),lng=parseFloat(m[3]);if(isFinite(lat)&&isFinite(lng)&&Math.abs(lat)<=90&&Math.abs(lng)<=180)p={lat,lng}}else{const parts=t.split(',');if(parts.length===2){const one=s=>{const x=s.trim().match(/^([NSEW])?\s*([+-]?\d+(\.\d+)?)\s*([NSEW])?$/i);if(!x)return null;const h=(x[1]||x[4]||'').toUpperCase();let v=parseFloat(x[2]);if(h==='S'||h==='W')v=-Math.abs(v);if(h==='N'||h==='E')v=Math.abs(v);return{v,h}};const a=one(parts[0]),b=one(parts[1]);if(a&&b){const lat=(a.h==='N'||a.h==='S')?a.v:b.v,lng=(a.h==='E'||a.h==='W')?a.v:b.v;if(Math.abs(lat)<=90&&Math.abs(lng)<=180)p={lat,lng}}}}
if(!p)return alert('Could not parse coordinates. Try "34.851939,-119.168399" or "34.851939 N, -119.168399 W".');upsertW(wpName.value,p.lat,p.lng);wpName.value='';wpCoords.value=''});
$('wpList').addEventListener('click',e=>{const t=e.target,go=t.getAttribute('data-go'),del=t.getAttribute('data-del');if(go!=null){const w=loadW()[+go];if(w){map.setView([w.lat,w.lng],16);markers.get(w.name)?.openPopup()}}if(del!=null)delW(+del)});

renderW();syncM();applyBearing(S.bearing);refreshRay();refreshNav();
})();
</script>
</body></html>
